<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chat Application</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>Test Real-time Chat</h1>

<!-- Sender Section -->
<div>
    <h2>Sender</h2>
    <input type="text" id="senderId" placeholder="Sender ID" />
    <input type="text" id="receiverId" placeholder="Receiver ID" />
    <input type="text" id="messageContent" placeholder="Message content" />
    <button onclick="sendMessage()">Send Message</button>
</div>

<!-- Receiver Section -->
<div>
    <h2>Receiver</h2>
    <p id="receivedMessages">Received Messages:</p>
</div>

<script>
    var stompClient = null;
    var receiverId = ""; // Will hold the receiver ID for listening

    // Connect to WebSocket
    function connectWebSocket() {
        var socket = new WebSocket('ws://localhost:8080/ws');// WebSocket endpoint (ensure your server is running)
        stompClient = Stomp.over(socket);

        // Connect with WebSocket
        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);

            // Subscribe to receiver's message queue
            receiverId = document.getElementById("receiverId").value;
            stompClient.subscribe('/queue/' + receiverId, function (message) {
                showReceivedMessage(message.body);
            });
        });
    }

    // Send message function
    function sendMessage() {
        var senderId = document.getElementById("senderId").value;
        var receiverId = document.getElementById("receiverId").value;
        var content = document.getElementById("messageContent").value;

        // Create a message object
        var message = {
            senderId: senderId,
            receiverId: receiverId,
            content: content,
            type: 'CHAT'
        };

        console.log("Receiver ID: ", receiverId); // Kiểm tra giá trị receiverId
        stompClient.subscribe('/queue/' + receiverId, function (message) {
            showReceivedMessage(message.body);
        });

        // Send the message to the server
        stompClient.send("/v1/chat-send", {}, JSON.stringify(message));

    }

    // Show received messages on UI
    function showReceivedMessage(message) {
        var receivedMessagesDiv = document.getElementById("receivedMessages");
        console.log('Received message:', message);
        receivedMessagesDiv.innerHTML += '<br/>' + message;
    }

    // Auto-connect to WebSocket on page load
    window.onload = function () {
        connectWebSocket();
    };



</script>
</body>
</html>
